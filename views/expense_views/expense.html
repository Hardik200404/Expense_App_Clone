<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Expense App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script>
        window.onload=event=>{
            //get all the expenses of the user logged in
            let token = localStorage.getItem('token')
            fetch('http://localhost:3000/expense/get-expense',{
            method: 'GET',
            contentType: 'application/json',
            headers: {"Authorization": token}
            }).then(res=>{
                return res.json()
            }).then(data=>{
                for(expense of data){
                    let expense_details={}
                    expense_details.id=expense.id
                    expense_details.expense_cost=expense.expense_cost
                    expense_details.description=expense.description
                    expense_details.category=expense.category
                    display_expense(expense_details)
                }
            }).catch(err=>{
                console.log(err)
            })

            fetch('http://localhost:3000/user/check-premium',{
                method: 'GET',
                contentType: 'application/json',
                headers: {"Authorization": token}
            }).then(response=>{
                if(response.status==200){
                    return response.json()
                }
            }).then(response=>{
                //display username
                let name_h = document.createElement('h6')
                name_h.innerHTML = 'Welcome '+response.username
                let body_tag = document.getElementsByTagName('body')
                body_tag[0].prepend(name_h)

                //remove or add preimum button based on is_premium
                if(response.is_premium){
                    let premium_btn = document.getElementById('premium_btn')
                    if(premium_btn){
                        premium_btn.remove()
                    }
                    //show the user is premium
                    let preimum_p = document.createElement('h6')
                    preimum_p.innerHTML = 'You Are A Premium User '+ String.fromCodePoint(0x26A1)
                    body_tag[0].prepend(preimum_p)

                    //show leaderboard feature
                    let leaderboard_btn = document.createElement('button')
                    leaderboard_btn.id = 'leaderboard_btn'
                    leaderboard_btn.innerHTML = 'Show Leaderboard'
                    leaderboard_btn.setAttribute('onclick','show_leaderboard(event)')
                    body_tag[0].append(leaderboard_btn)
                }else{
                    let premium_btn = document.createElement('button')
                    premium_btn.id = 'premium_btn'
                    premium_btn.innerHTML = 'Buy Premium Membership'
                    premium_btn.setAttribute('onclick','buy_premium(event)')
                    body_tag[0].append(premium_btn)
                }
            }).catch(err=>{
                console.log(err)
            })
        }
    </script>
</head>

<body style="margin: 0">
  <h4>Expense Tracker</h4>
  <form onsubmit="handle_submit(event)">
    <input type="hidden" name="expense_id">
    <label for="expense_cost">Choose Expense:</label>
    <input type="number" name="expense_cost" id="expense_cost" min="1"/>
    <label for="description">Choose Description:</label>
    <input type="text" name="description" id="description" />
    <label for="category">Category</label>
    <select name="category" id="category">
        <option value="Bill">Bill</option>
        <option value="Food">Food</option>
        <option value="Movie">Movie</option>
        <option value="Travel">Travel</option>
    </select>
    <button type="submit">Submit</button>
  </form>
  <div id="expense_div">
    <h4>Expenses</h4>
    <ul></ul>
  </div>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <div id="leaderboard_div"><ul></ul></div>
</body>
<script src="script.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.2/axios.min.js" integrity="sha512-JSCFHhKDilTRRXe9ak/FJ28dcpOJxzQaCd3Xg8MyF6XFjODhy/YMCM8HW0TFDckNHWUewW+kfvhin43hKtJxAw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</html>